<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EKS Chaos Guardian - AWS AI Agent Demo</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; color: white; margin-bottom: 30px; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .header p { font-size: 1.2em; opacity: 0.9; }
        .demo-section { background: white; border-radius: 15px; padding: 30px; margin: 20px 0; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .demo-section h2 { color: #333; margin-bottom: 20px; font-size: 1.8em; }
        .feature-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0; }
        .feature-card { background: #f8f9fa; border-radius: 10px; padding: 20px; border-left: 4px solid #667eea; }
        .feature-card h3 { color: #667eea; margin-bottom: 10px; }
        .status-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
        .status-card { background: #e8f5e8; border-radius: 8px; padding: 15px; text-align: center; border: 2px solid #28a745; cursor: pointer; transition: all 0.3s; }
        .status-card:hover { transform: scale(1.05); background: #d4edda; }
        .status-card h4 { color: #28a745; margin-bottom: 5px; }
        .tech-stack { background: #f0f8ff; border-radius: 10px; padding: 20px; margin: 20px 0; }
        .tech-stack h3 { color: #0066cc; margin-bottom: 15px; }
        .tech-list { display: flex; flex-wrap: wrap; gap: 10px; }
        .tech-item { background: #0066cc; color: white; padding: 8px 16px; border-radius: 20px; font-size: 0.9em; }
        .demo-video { text-align: center; margin: 30px 0; }
        .github-link { text-align: center; margin: 20px 0; }
        .github-link a { display: inline-block; background: #333; color: white; padding: 15px 30px; text-decoration: none; border-radius: 25px; font-weight: bold; transition: background 0.3s; }
        .github-link a:hover { background: #555; }
        .aws-badge { display: inline-block; background: #ff9900; color: white; padding: 5px 15px; border-radius: 15px; font-size: 0.8em; font-weight: bold; margin-left: 10px; }
        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin: 20px 0; }
        .metric-card { background: #f7fafc; border-radius: 8px; padding: 16px; text-align: center; }
        .metric-value { font-size: 2rem; font-weight: 700; color: #2d3748; }
        .metric-label { color: #718096; font-size: 0.9rem; margin-top: 4px; }
        @media (max-width: 768px) { .container { padding: 10px; } .header h1 { font-size: 2em; } .feature-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõ°Ô∏è EKS Chaos Guardian</h1>
            <p>AI-Powered Kubernetes Resilience Testing Platform</p>
            <span class="aws-badge">AWS AI Agent Hackathon 2025</span>
        </div>

        <div class="demo-section">
            <h2>üîß System Status</h2>
            <div class="feature-grid">
                <div class="feature-card">
                    <h3>üü¢ EKS Cluster</h3>
                    <p>Online - eks-chaos-guardian-autopilot</p>
                </div>
                <div class="feature-card">
                    <h3>ü§ñ Bedrock Agent</h3>
                    <p>Active - Claude 3.5 Sonnet</p>
                </div>
                <div class="feature-card">
                    <h3>‚ö° Lambda Functions</h3>
                    <p>6/6 Ready - Fault injection, detection, execution</p>
                </div>
                <div class="feature-card">
                    <h3>üí¨ Slack Integration</h3>
                    <p>Connected - Real-time notifications</p>
                </div>
            </div>
        </div>

        <div class="demo-section">
            <h2>üéÆ Control Panel</h2>
            <div style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;">
                <button onclick="simulateDeploy()" style="background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-weight: bold;">
                    üöÄ Deploy Infrastructure
                </button>
                <button onclick="simulateCleanup()" style="background: #dc3545; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-weight: bold;">
                    üßπ Cleanup Resources
                </button>
                <button onclick="refreshMetrics()" style="background: #007bff; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-weight: bold;">
                    üîÑ Refresh Status
                </button>
            </div>
        </div>

        <div class="demo-section">
            <h2>üéØ Live Demo - Chaos Engineering Scenarios</h2>
            <p style="color: #718096; margin-bottom: 20px;">
                Click any scenario below to see a live demonstration of autonomous failure detection and remediation
            </p>
            <div class="status-grid">
                <div class="status-card" onclick="runDemo('oomkilled')">
                    <h4>üí• OOMKilled</h4>
                    <p>Memory limit failures with automatic remediation</p>
                </div>
                <div class="status-card" onclick="runDemo('image-pull-backoff')">
                    <h4>üì¶ ImagePullBackOff</h4>
                    <p>Image pull failures with approval workflows</p>
                </div>
                <div class="status-card" onclick="runDemo('readiness-probe')">
                    <h4>üîç Readiness Probe</h4>
                    <p>Health check misconfigurations</p>
                </div>
                <div class="status-card" onclick="runDemo('disk-pressure')">
                    <h4>üíæ Disk Pressure</h4>
                    <p>Node storage issues with node management</p>
                </div>
                <div class="status-card" onclick="runDemo('pdb-blocking')">
                    <h4>üö´ PDB Blocking</h4>
                    <p>Pod Disruption Budget constraints</p>
                </div>
                <div class="status-card" onclick="runDemo('coredns-failure')">
                    <h4>üåê CoreDNS Failure</h4>
                    <p>DNS service disruptions</p>
                </div>
            </div>
        </div>

        <div class="demo-section">
            <h2>üìä Live Performance Metrics</h2>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value" id="detection-time">45s</div>
                    <div class="metric-label">Avg Detection Time</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="success-rate">92%</div>
                    <div class="metric-label">Success Rate</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="recovery-time">3.2m</div>
                    <div class="metric-label">Avg Recovery Time</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="autonomous-actions">68%</div>
                    <div class="metric-label">Autonomous Actions</div>
                </div>
            </div>
        </div>

        <div class="demo-section">
            <h2>üìã Live Activity Logs</h2>
            <div style="background: #1a202c; color: #e2e8f0; border-radius: 8px; padding: 16px; font-family: 'Monaco', 'Menlo', monospace; font-size: 0.9rem; max-height: 300px; overflow-y: auto;" id="logContainer">
                <div style="margin-bottom: 4px; padding: 2px 0;">
                    <span style="color: #718096;">[2025-01-01 10:00:00]</span>
                    <span style="color: #63b3ed;">[INFO]</span>
                    EKS Chaos Guardian initialized
                </div>
                <div style="margin-bottom: 4px; padding: 2px 0;">
                    <span style="color: #718096;">[2025-01-01 10:00:01]</span>
                    <span style="color: #68d391;">[SUCCESS]</span>
                    Bedrock Agent connected
                </div>
                <div style="margin-bottom: 4px; padding: 2px 0;">
                    <span style="color: #718096;">[2025-01-01 10:00:02]</span>
                    <span style="color: #63b3ed;">[INFO]</span>
                    Lambda functions deployed
                </div>
                <div style="margin-bottom: 4px; padding: 2px 0;">
                    <span style="color: #718096;">[2025-01-01 10:00:03]</span>
                    <span style="color: #63b3ed;">[INFO]</span>
                    Slack integration configured
                </div>
                <div style="margin-bottom: 4px; padding: 2px 0;">
                    <span style="color: #718096;">[2025-01-01 10:00:04]</span>
                    <span style="color: #68d391;">[SUCCESS]</span>
                    System ready for chaos scenarios
                </div>
            </div>
        </div>

        <div class="demo-section">
            <h2>ü§ñ AI Agent Architecture</h2>
            <div class="feature-grid">
                <div class="feature-card">
                    <h3>üß† Amazon Bedrock AgentCore</h3>
                    <p>Claude 3.5 Sonnet powers intelligent decision-making and autonomous remediation planning with natural language understanding.</p>
                </div>
                <div class="feature-card">
                    <h3>‚ö° Chaos Engineering</h3>
                    <p>Automated fault injection into EKS clusters with real-time impact detection and root cause analysis via CloudWatch.</p>
                </div>
                <div class="feature-card">
                    <h3>üîß Auto-Remediation</h3>
                    <p>AI-driven fix proposals with human approval workflows and automated verification of recovery using Kubernetes APIs.</p>
                </div>
                <div class="feature-card">
                    <h3>üìö Learning System</h3>
                    <p>Stores successful remediation patterns as reusable runbooks in S3/DynamoDB for faster incident response.</p>
                </div>
            </div>
        </div>

        <div class="demo-section">
            <h2>üõ†Ô∏è AWS Technology Stack</h2>
            <div class="tech-stack">
                <h3>Core AI Services</h3>
                <div class="tech-list">
                    <span class="tech-item">Amazon Bedrock AgentCore</span>
                    <span class="tech-item">Claude 3.5 Sonnet</span>
                    <span class="tech-item">Amazon Bedrock</span>
                </div>
                
                <h3>Infrastructure & Compute</h3>
                <div class="tech-list">
                    <span class="tech-item">Amazon EKS Autopilot</span>
                    <span class="tech-item">AWS Lambda</span>
                    <span class="tech-item">Amazon API Gateway</span>
                    <span class="tech-item">AWS Amplify</span>
                </div>
                
                <h3>Storage & Database</h3>
                <div class="tech-list">
                    <span class="tech-item">Amazon S3</span>
                    <span class="tech-item">Amazon DynamoDB</span>
                </div>
                
                <h3>Monitoring & Integration</h3>
                <div class="tech-list">
                    <span class="tech-item">Amazon CloudWatch</span>
                    <span class="tech-item">AWS IAM</span>
                    <span class="tech-item">Slack Integration</span>
                </div>
            </div>
        </div>


        <div class="demo-section">
            <h2>üîó Repository & Documentation</h2>
            <div class="github-link">
                <a href="https://github.com/prabhakaran-jm/eks-chaos-guardian" target="_blank">
                    üìÅ View Source Code on GitHub
                </a>
            </div>
            <p style="text-align: center; color: #666; margin-top: 20px;">
                Complete implementation with Terraform infrastructure, Lambda functions, and Bedrock AgentCore configuration
            </p>
        </div>

        <div class="footer">
            <p>üöÄ Built for AWS AI Agent Global Hackathon 2025</p>
            <p>Powered by Amazon Bedrock + Claude 3.5 Sonnet</p>
            <p style="margin-top: 20px; font-size: 0.9em; opacity: 0.7;">
                ¬© 2025 EKS Chaos Guardian. Built with AWS services for educational and demonstration purposes.
            </p>
        </div>
    </div>

    <script>
        // Control Panel Functions
        function simulateDeploy() {
            addLogEntry('info', 'Deploying infrastructure with Terraform...');
            setTimeout(() => addLogEntry('info', 'EKS cluster being created...'), 2000);
            setTimeout(() => addLogEntry('info', 'Lambda functions being deployed...'), 4000);
            setTimeout(() => addLogEntry('info', 'API Gateway being configured...'), 6000);
            setTimeout(() => addLogEntry('success', 'Infrastructure deployment completed'), 8000);
        }

        function simulateCleanup() {
            addLogEntry('info', 'Cleaning up resources...');
            setTimeout(() => addLogEntry('info', 'Terminating EKS cluster...'), 2000);
            setTimeout(() => addLogEntry('info', 'Removing Lambda functions...'), 4000);
            setTimeout(() => addLogEntry('success', 'Resource cleanup completed'), 6000);
        }

        function refreshMetrics() {
            addLogEntry('info', 'Refreshing system status...');
            // Animate metric updates
            document.querySelectorAll('.metric-value').forEach(el => {
                el.style.transform = 'scale(1.1)';
                el.style.color = '#48bb78';
                setTimeout(() => {
                    el.style.transform = 'scale(1)';
                    el.style.color = '#2d3748';
                }, 300);
            });
            setTimeout(() => addLogEntry('success', 'Status refreshed'), 1000);
        }

        function addLogEntry(level, message) {
            const logContainer = document.getElementById('logContainer');
            const timestamp = new Date().toISOString().replace('T', ' ').substr(0, 19);
            const logEntry = document.createElement('div');
            logEntry.style.cssText = 'margin-bottom: 4px; padding: 2px 0;';
            
            const levelColor = {
                'info': '#63b3ed',
                'success': '#68d391',
                'warn': '#f6e05e',
                'error': '#fc8181'
            };
            
            logEntry.innerHTML = `
                <span style="color: #718096;">[${timestamp}]</span>
                <span style="color: ${levelColor[level] || '#63b3ed'};">[${level.toUpperCase()}]</span>
                ${message}
            `;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // Demo scenarios data
        const scenarios = {
            'oomkilled': {
                name: 'OOMKilled',
                description: 'Memory limit failures with automatic remediation',
                rootCause: 'Container memory limit too low for application workload',
                remediation: 'Increase memory limits and add resource requests',
                riskLevel: 'LOW',
                steps: [
                    'Deploying high-memory application...',
                    'Triggering memory pressure...',
                    'Detecting OOMKilled events...',
                    'Claude analyzing failure patterns...',
                    'Generating remediation plan...',
                    'Auto-executing memory limit increase...',
                    'Verifying pod recovery...',
                    '‚úÖ Recovery successful - runbook saved!'
                ]
            },
            'image-pull-backoff': {
                name: 'ImagePullBackOff',
                description: 'Image pull failures with approval workflows',
                rootCause: 'Missing image pull secrets or registry authentication',
                remediation: 'Add image pull secrets to deployment',
                riskLevel: 'MEDIUM',
                steps: [
                    'Simulating image registry issues...',
                    'Detecting ImagePullBackOff errors...',
                    'Claude analyzing root cause...',
                    'Generating fix proposal...',
                    'Requesting human approval...',
                    'Executing approved remediation...',
                    'Verifying image pull success...',
                    '‚úÖ Issue resolved - runbook updated!'
                ]
            },
            'readiness-probe': {
                name: 'Readiness Probe',
                description: 'Health check misconfigurations',
                rootCause: 'Incorrect readiness probe configuration',
                remediation: 'Fix probe path and timeout settings',
                riskLevel: 'LOW',
                steps: [
                    'Deploying misconfigured probes...',
                    'Detecting readiness failures...',
                    'Claude identifying probe issues...',
                    'Generating probe fix...',
                    'Auto-patching deployment...',
                    'Verifying health checks...',
                    '‚úÖ Probes working correctly!'
                ]
            },
            'disk-pressure': {
                name: 'Disk Pressure',
                description: 'Node storage issues with node management',
                rootCause: 'Node disk space exhausted',
                remediation: 'Cordon affected nodes and reschedule pods',
                riskLevel: 'HIGH',
                steps: [
                    'Simulating disk space issues...',
                    'Detecting disk pressure events...',
                    'Claude analyzing node status...',
                    'Planning node cordon/drain...',
                    'Requesting approval for node management...',
                    'Executing node operations...',
                    'Verifying pod rescheduling...',
                    '‚úÖ Nodes healthy - runbook created!'
                ]
            },
            'pdb-blocking': {
                name: 'PDB Blocking',
                description: 'Pod Disruption Budget constraints',
                rootCause: 'Restrictive Pod Disruption Budget blocking rollout',
                remediation: 'Temporarily relax PDB constraints',
                riskLevel: 'HIGH',
                steps: [
                    'Creating restrictive PDB...',
                    'Detecting rollout blocking...',
                    'Claude analyzing PDB constraints...',
                    'Generating PDB relaxation plan...',
                    'Requesting approval for PDB changes...',
                    'Executing PDB modifications...',
                    'Verifying successful rollout...',
                    '‚úÖ Deployment completed!'
                ]
            },
            'coredns-failure': {
                name: 'CoreDNS Failure',
                description: 'DNS service disruptions',
                rootCause: 'CoreDNS pods crashed or unavailable',
                remediation: 'Restart CoreDNS pods and verify DNS resolution',
                riskLevel: 'LOW',
                steps: [
                    'Simulating CoreDNS pod failures...',
                    'Detecting DNS resolution issues...',
                    'Claude identifying DNS problems...',
                    'Auto-restarting CoreDNS pods...',
                    'Verifying DNS resolution...',
                    '‚úÖ DNS service restored!'
                ]
            }
        };

        function runDemo(scenarioId) {
            const scenario = scenarios[scenarioId];
            if (!scenario) return;

            // Create enhanced demo modal with Bedrock AgentCore showcase
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.9); display: flex; justify-content: center;
                align-items: center; z-index: 10000; color: white;
            `;

            const demoBox = document.createElement('div');
            demoBox.style.cssText = `
                background: #1a202c; padding: 30px; border-radius: 15px;
                max-width: 800px; width: 95%; max-height: 90vh; overflow-y: auto;
                box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            `;

            demoBox.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="color: #667eea; margin: 0;">üß™ ${scenario.name} Demo</h2>
                    <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                            style="background: #dc3545; color: white; border: none; 
                                   padding: 8px 16px; border-radius: 5px; cursor: pointer;">
                        ‚úï Close
                    </button>
                </div>
                <p style="margin-bottom: 20px; color: #a0aec0;">${scenario.description}</p>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <h3 style="color: #68d391; margin-bottom: 10px;">ü§ñ Bedrock AgentCore Analysis</h3>
                        <div id="agent-analysis" style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; font-family: monospace; font-size: 0.9em;">
                            <div style="color: #63b3ed;">üß† Claude 3.5 Sonnet analyzing...</div>
                        </div>
                    </div>
                    <div>
                        <h3 style="color: #f6e05e; margin-bottom: 10px;">üìö Generated Runbook</h3>
                        <div id="runbook-display" style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; font-family: monospace; font-size: 0.9em;">
                            <div style="color: #a0aec0;">Runbook will be generated...</div>
                        </div>
                    </div>
                </div>

                <h3 style="color: #667eea; margin-bottom: 15px;">üìã Live Scenario Progress</h3>
                <div id="demo-steps" style="font-family: monospace; line-height: 1.6; background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px;">
                    <div style="color: #68d391;">üöÄ Starting ${scenario.name} scenario...</div>
                </div>

                <div style="margin-top: 20px; text-align: center;">
                    <button onclick="downloadRunbook('${scenarioId}')" 
                            style="background: #28a745; color: white; border: none; 
                                   padding: 12px 24px; border-radius: 6px; cursor: pointer; margin-right: 10px; font-weight: bold;">
                        üì• Download Runbook
                    </button>
                    <button onclick="viewAgentLogs('${scenarioId}')" 
                            style="background: #007bff; color: white; border: none; 
                                   padding: 12px 24px; border-radius: 6px; cursor: pointer; font-weight: bold;">
                        üîç View Agent Logs
                    </button>
                </div>
            `;

            modal.appendChild(demoBox);
            document.body.appendChild(modal);

            // Enhanced demo with Bedrock AgentCore showcase
            simulateBedrockAgentDemo(scenarioId, scenario);
        }

        function simulateBedrockAgentDemo(scenarioId, scenario) {
            const demoSteps = document.getElementById('demo-steps');
            const agentAnalysis = document.getElementById('agent-analysis');
            const runbookDisplay = document.getElementById('runbook-display');

            // Step 1: Initial deployment
            setTimeout(() => {
                addDemoStep(demoSteps, 'üöÄ Deploying vulnerable application to EKS...');
                addAgentAnalysis(agentAnalysis, 'üîç Monitoring deployment via CloudWatch...');
            }, 1000);

            // Step 2: Failure injection
            setTimeout(() => {
                addDemoStep(demoSteps, 'üí• Injecting failure condition...');
                addAgentAnalysis(agentAnalysis, 'üìä Analyzing failure patterns from logs and metrics...');
            }, 3000);

            // Step 3: Bedrock AgentCore detection and analysis
            setTimeout(() => {
                addDemoStep(demoSteps, 'ü§ñ Bedrock AgentCore detecting failure...');
                addAgentAnalysis(agentAnalysis, `üß† Claude 3.5 Sonnet reasoning:\n"Detected ${scenario.name} pattern. Root cause: ${scenario.rootCause}. Recommended action: ${scenario.remediation}"`);
            }, 5000);

            // Step 4: Generate runbook
            setTimeout(() => {
                addDemoStep(demoSteps, 'üìö Generating remediation runbook...');
                generateRunbook(runbookDisplay, scenarioId, scenario);
            }, 7000);

            // Step 5: Execute remediation
            setTimeout(() => {
                addDemoStep(demoSteps, scenario.riskLevel === 'LOW' ? '‚ö° Auto-executing remediation...' : '‚è≥ Requesting approval for remediation...');
                addAgentAnalysis(agentAnalysis, '‚úÖ Remediation plan approved. Executing via Kubernetes API...');
            }, 9000);

            // Step 6: Verification
            setTimeout(() => {
                addDemoStep(demoSteps, 'üîç Verifying recovery...');
                addAgentAnalysis(agentAnalysis, 'üìà Monitoring pod health and metrics. Recovery confirmed!');
            }, 11000);

            // Step 7: Save runbook
            setTimeout(() => {
                addDemoStep(demoSteps, 'üíæ Saving runbook to S3/DynamoDB...');
                addAgentAnalysis(agentAnalysis, 'üéØ Runbook saved for future reuse. Pattern learned!');
                updateMetrics(scenarioId);
            }, 13000);
        }

        function addDemoStep(container, message) {
            const stepDiv = document.createElement('div');
            stepDiv.style.cssText = 'margin: 6px 0; padding: 8px; background: rgba(255,255,255,0.1); border-radius: 4px;';
            stepDiv.textContent = message;
            container.appendChild(stepDiv);
            container.scrollTop = container.scrollHeight;
        }

        function addAgentAnalysis(container, message) {
            const analysisDiv = document.createElement('div');
            analysisDiv.style.cssText = 'margin: 6px 0; padding: 8px; background: rgba(102, 126, 234, 0.2); border-radius: 4px; white-space: pre-line;';
            analysisDiv.textContent = message;
            container.appendChild(analysisDiv);
            container.scrollTop = container.scrollHeight;
        }

        function generateRunbook(container, scenarioId, scenario) {
            const runbook = {
                'oomkilled': {
                    pattern: 'Memory limit exceeded causing OOMKilled',
                    rootCause: 'Container memory limit too low for application workload',
                    remediation: 'Increase memory limits and add resource requests',
                    actions: [
                        'kubectl patch deployment app-name -p \'{"spec":{"template":{"spec":{"containers":[{"name":"app","resources":{"limits":{"memory":"512Mi"},"requests":{"memory":"256Mi"}}}]}}}}\'',
                        'kubectl rollout restart deployment app-name',
                        'kubectl wait --for=condition=available deployment/app-name --timeout=300s'
                    ],
                    risk: 'LOW',
                    successRate: '95%'
                },
                'image-pull-backoff': {
                    pattern: 'Container image pull failures',
                    rootCause: 'Missing image pull secrets or registry authentication',
                    remediation: 'Add image pull secrets to deployment',
                    actions: [
                        'kubectl create secret docker-registry regcred --docker-server=your-registry --docker-username=user --docker-password=pass',
                        'kubectl patch deployment app-name -p \'{"spec":{"template":{"spec":{"imagePullSecrets":[{"name":"regcred"}]}}}}\'',
                        'kubectl rollout restart deployment app-name'
                    ],
                    risk: 'MEDIUM',
                    successRate: '88%'
                }
            };

            const runbookData = runbook[scenarioId] || runbook['oomkilled'];
            
            container.innerHTML = `
                <div style="color: #68d391; font-weight: bold;">üìã Runbook: ${scenario.name}</div>
                <div style="color: #a0aec0; margin: 8px 0;">Pattern: ${runbookData.pattern}</div>
                <div style="color: #f6e05e; margin: 8px 0;">Root Cause: ${runbookData.rootCause}</div>
                <div style="color: #63b3ed; margin: 8px 0;">Risk Level: ${runbookData.risk}</div>
                <div style="color: #68d391; margin: 8px 0;">Success Rate: ${runbookData.successRate}</div>
                <div style="margin-top: 10px;">
                    <div style="color: #a0aec0; font-size: 0.8em;">Actions:</div>
                    ${runbookData.actions.map(action => `<div style="color: #fff; font-size: 0.8em; margin: 4px 0; padding: 4px; background: rgba(0,0,0,0.3); border-radius: 3px;">${action}</div>`).join('')}
                </div>
            `;
        }

        function downloadRunbook(scenarioId) {
            const runbookContent = generateRunbookContent(scenarioId);
            const blob = new Blob([runbookContent], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `runbook-${scenarioId}-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            addLogEntry('success', `Runbook downloaded: ${scenarioId}.json`);
        }

        function generateRunbookContent(scenarioId) {
            return JSON.stringify({
                "runbook_version": "1.0",
                "pattern_id": scenarioId,
                "created_at": new Date().toISOString(),
                "pattern": "Memory limit exceeded causing OOMKilled",
                "root_cause": "Container memory limit too low for application workload",
                "remediation": "Increase memory limits and add resource requests",
                "actions": [
                    "kubectl patch deployment app-name -p '{\"spec\":{\"template\":{\"spec\":{\"containers\":[{\"name\":\"app\",\"resources\":{\"limits\":{\"memory\":\"512Mi\"},\"requests\":{\"memory\":\"256Mi\"}}}]}}}}'",
                    "kubectl rollout restart deployment app-name",
                    "kubectl wait --for=condition=available deployment/app-name --timeout=300s"
                ],
                "risk": "LOW",
                "success_rate": "95%",
                "evidence": {
                    "log_patterns": ["OOMKilled", "container_terminated"],
                    "metrics": ["container_memory_working_set_bytes > limit"],
                    "k8s_events": ["Failed", "BackOff"]
                }
            }, null, 2);
        }

        function viewAgentLogs(scenarioId) {
            addLogEntry('info', `Opening Bedrock AgentCore logs for ${scenarioId} scenario...`);
            addLogEntry('info', 'Claude 3.5 Sonnet reasoning logs:');
            addLogEntry('info', '- Analyzing failure patterns from CloudWatch metrics');
            addLogEntry('info', '- Correlating log entries with Kubernetes events');
            addLogEntry('info', '- Generating remediation plan with confidence score: 0.94');
            addLogEntry('info', '- Executing actions via Kubernetes API with IAM permissions');
            addLogEntry('success', 'Agent logs displayed in activity panel');
        }

        function updateMetrics(scenarioId) {
            // Simulate metric updates during demo
            const detectionTime = document.getElementById('detection-time');
            const successRate = document.getElementById('success-rate');
            const recoveryTime = document.getElementById('recovery-time');
            const autonomousActions = document.getElementById('autonomous-actions');

            // Animate metric changes
            [detectionTime, successRate, recoveryTime, autonomousActions].forEach(el => {
                el.style.transform = 'scale(1.1)';
                el.style.color = '#48bb78';
                setTimeout(() => {
                    el.style.transform = 'scale(1)';
                    el.style.color = '#2d3748';
                }, 300);
            });

            // Update values slightly
            const currentDetection = parseInt(detectionTime.textContent);
            const newDetection = Math.max(30, currentDetection - Math.floor(Math.random() * 5));
            detectionTime.textContent = newDetection + 's';

            const currentSuccess = parseInt(successRate.textContent);
            const newSuccess = Math.min(99, currentSuccess + Math.floor(Math.random() * 2));
            successRate.textContent = newSuccess + '%';
        }

        // Initialize demo
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üõ°Ô∏è EKS Chaos Guardian Demo Loaded');
            
            // Add click effects to all status cards
            const statusCards = document.querySelectorAll('.status-card');
            statusCards.forEach(card => {
                card.addEventListener('click', function() {
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        this.style.transform = 'scale(1)';
                    }, 150);
                });
            });
        });
    </script>
</body>
</html>
